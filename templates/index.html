<!-- loading the page from base.html -->
{% extends 'base.html' %}

{% block page_title %}

    <title>Dashboard - AutoPart</title>

{% endblock %}

{% block admin_name %}
  <div>{{ admin_name }}</div>
{% endblock %}

{% block content_title %}

    <h2 class="page-title">
        Dashboard
    </h2>

{% endblock %}

{% block main_content %}

<div class="col-12">
    <div class="row row-cards">
      <div class="col-sm-6 col-lg-4">
        <div class="card card-sm">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-auto">
                <span class="bg-primary text-white avatar"><!-- Download SVG icon from http://tabler-icons.io/i/currency-dollar -->
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-building-warehouse">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                    <path d="M3 21v-13l9 -4l9 4v13" />
                    <path d="M13 13h4v8h-10v-6h6" />
                    <path d="M13 21v-9a1 1 0 0 0 -1 -1h-2a1 1 0 0 0 -1 1v3" />
                  </svg>                  
                </span>
              </div>
              <div class="col">
                <div class="font-weight-medium">
                  {{ total_parts }}
                </div>
                <div class="text-secondary">
                  Total Parts
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-4">
        <div class="card card-sm">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-auto">
                <span class="bg-primary text-white avatar"><!-- Download SVG icon from http://tabler-icons.io/i/shopping-cart -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <path d="M18,20.5v3.5h-1v-3.5c0-.827-.673-1.5-1.5-1.5h-7c-.827,0-1.5,.673-1.5,1.5v3.5h-1v-3.5c0-1.379,1.122-2.5,2.5-2.5h7c1.378,0,2.5,1.121,2.5,2.5Zm-6-10.5c-1.93,0-3.5,1.57-3.5,3.5s1.57,3.5,3.5,3.5,3.5-1.57,3.5-3.5-1.57-3.5-3.5-3.5Zm0,6c-1.378,0-2.5-1.121-2.5-2.5s1.122-2.5,2.5-2.5,2.5,1.121,2.5,2.5-1.122,2.5-2.5,2.5Zm-2.84-8.736l.618,.502,2.221-1.44,2.222,1.44,.625-.48-.707-2.365,1.861-1.5v-.795h-2.683l-.92-2.626h-.794l-.92,2.626h-2.683v.795l1.861,1.5-.7,2.343Zm.687-3.638h1.544l.608-1.735,.608,1.735h1.544l-1.164,.938,.449,1.502-1.438-.933-1.438,.933,.449-1.502-1.164-.938Zm-3.626,7.14l.625-.48-.707-2.365,1.861-1.5v-.795h-2.683l-.92-2.626h-.794l-.92,2.626H0v.795l1.861,1.5-.703,2.352,.621,.493,2.221-1.44,2.222,1.44ZM1.848,6.626h1.544l.608-1.735,.608,1.735h1.544l-1.164,.938,.449,1.502-1.438-.933-1.438,.933,.449-1.502-1.164-.938Zm22.152-1h-2.683l-.92-2.626h-.794l-.92,2.626h-2.683v.795l1.861,1.5-.7,2.341,.618,.505,2.221-1.44,2.222,1.44,.625-.48-.707-2.365,1.861-1.5v-.795Zm-3.011,1.938l.449,1.502-1.438-.933-1.438,.933,.449-1.502-1.164-.938h1.544l.608-1.735,.608,1.735h1.544l-1.164,.938Z"/>
                  </svg>
                </span>
              </div>
              <div class="col">
                <div class="font-weight-medium">
                  {{ total_customers }}
                </div>
                <div class="text-secondary">
                  Total Customers
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-4">
        <div class="card card-sm">
          <div class="card-body">
            <div class="row align-items-center">
              <div class="col-auto">
                <span class="bg-primary text-white avatar"><!-- Download SVG icon from http://tabler-icons.io/i/shopping-cart -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
                    <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                    <circle cx="8" cy="6" r="5" />
                    <path d="M4 15h4v1H4c-1.654 0-3 1.346-3 3v5h1v-5c0-1.105.895-2 2-2z" />
                    <circle cx="17" cy="17" r="2" />
                    <path d="M20 17c0-.353-.046-.716-.14-1.101l1.941-1.133-1.513-2.591-1.936 1.13c-.537-.488-1.167-.851-1.853-1.068v-2.238h-3v2.238c-.687.217-1.316.58-1.853 1.068l-1.936-1.13-1.513 2.591 1.941 1.133c-.094.385-.14.748-.14 1.101s.046.715.14 1.1l-1.941 1.134 1.513 2.591 1.936-1.131c.537.489 1.167.852 1.853 1.068v2.238h3v-2.238c.687-.217 1.316-.58 1.853-1.068l1.936 1.131 1.513-2.591-1.941-1.134c.094-.385.14-.747.14-1.1z" />
                  </svg>                                   
                </span>
              </div>
              <div class="col">
                <div class="font-weight-medium">
                  {{ total_admins }}
                </div>
                <div class="text-secondary">
                  Total Admins
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-lg-6 col-xl-4">
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              Today's Update
            </div>
            <div class="card-actions">
              <div>
                <div class="row align-items-center">
                  
                  <div class="col">
                    <div class="card-subtitle">Credited: {{ cr_values[0] }}</div>
                    <div class="card-subtitle">Not credited: {{ cr_values[1] }}</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="card-body">
            <div id="chart-demo-pie"></div>
          </div>
        </div>
      </div>
      <div class="col-lg-12 col-xl-8">
        <div class="card">
          <div class="card-header">
            <div class="card-title">
              Top 5 companies
            </div>
            <div class="card-actions">
              <div>
                <div class="row align-items-center">
                  
                  <div class="col">
                    <div class="card-title" id="show_month_year"></div>
                  </div>
                </div>
              </div>
            </div>
            
          </div>
          <div class="card-body">
            <div id="chart-completion-tasks-6"></div>
          </div>
        </div>
      </div>
    </div>
</div>

{% endblock %}

{% block js_content %}

<script src="{{ url_for('static', filename='libs/apexcharts/dist/apexcharts.min.js') }}" defer></script> 

<script>
  // Create a new Date object
  const currentDate = new Date();

  // Get the full year
  const year = currentDate.getFullYear();

  // Get the month name
  const month = currentDate.toLocaleString('default', { month: 'long' });

  // Format as "Month, Year"
  const formattedDate = `${month}, ${year}`;

  // Display it in the HTML element
  document.getElementById('show_month_year').textContent = formattedDate;
</script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Passing Python cr_values to JavaScript
    const crValues = {{ cr_values|tojson }};

    // Initialize the ApexChart
    window.ApexCharts && (new ApexCharts(document.getElementById('chart-demo-pie'), {
      chart: {
        type: "donut",
        fontFamily: 'inherit',
        height: 278,
        sparkline: {
          enabled: true
        },
        animations: {
          enabled: true
        },
      },
      fill: {
        opacity: 1,
      },
      series: crValues, // Use the dynamically passed cr_values list
      labels: ["Credited", "Not Credited"],
      tooltip: {
        theme: 'dark'
      },
      grid: {
        strokeDashArray: 4,
      },
      colors: [tabler.getColor("primary"), tabler.getColor("primary", 0.8), tabler.getColor("primary", 0.6), tabler.getColor("gray-300")],
      legend: {
        show: true,
        position: 'bottom',
        offsetY: 12,
        markers: {
          width: 10,
          height: 10,
          radius: 100,
        },
        itemMargin: {
          horizontal: 8,
          vertical: 8
        },
      },
      tooltip: {
        fillSeriesColor: false
      },
    })).render();
  });
</script>

<script>
  // @formatter:off
  document.addEventListener("DOMContentLoaded", function () {
    // Passing Python cr_values to JavaScript
    const top_companies = {{ total_values_company | tojson }};
    // Passing Python cr_values to JavaScript
    const top_counts = {{ total_values_count | tojson }};

    console.log(top_companies)
    console.log(top_counts)
    window.ApexCharts && (new ApexCharts(document.getElementById('chart-completion-tasks-6'), {
      chart: {
        type: "bar",
        fontFamily: 'inherit',
        height: 240,
        parentHeightOffset: 0,
        toolbar: {
          show: false,
        },
        animations: {
          enabled: false
        },
      },
      plotOptions: {
        bar: {
          barHeight: '50%',
           horizontal: true,
        }
      },
      dataLabels: {
        enabled: false,
      },
      fill: {
        opacity: 1,
      },
      series: [{
        name: "Total returned parts",
        data: top_counts
      }],
      tooltip: {
        theme: 'dark'
      },
      grid: {
        padding: {
          top: -20,
          right: 0,
          left: -4,
          bottom: -4
        },
        strokeDashArray: 4,
      },
      xaxis: {
        labels: {
          padding: 0,
        },
        tooltip: {
          enabled: false
        },
        axisBorder: {
          show: false,
        },
        type: 'string',
      },
      yaxis: {
        labels: {
          padding: 4
        },
      },
      labels: top_companies,
      colors: [tabler.getColor("primary")],
      legend: {
        show: false,
      },
    })).render();
  });
  // @formatter:on
</script>
{% endblock %}
